## 技术选型
前端: react + antd
网关: nginx 静态资源 动态资源负载均衡
后台: nodejs
api文档: swagger yapi
数据库: redis mysql typeorm
项目会议部署: docker pm2

### 快速新建模块
```JS
nest g resource <模块名字> // 生成模块
nest g mdule redis // 单独生成 module
nest g service redis // 单独生成 service

nest g guard login --flat --no-spec  // 登陆守卫
nest g guard permission --flat --no-spec // 权限守卫
```

创建拦截器
```JS
nest g interceptor format-response --flat
 
// 常见的操作符:
// tap  不修改响应式的内容 执行一些额外的逻辑 logger
// map  修改响应式的内容
// switchMap  修改响应式的内容 执行一些额外的逻辑
// catchError  处理异常,在 exception 之前抛出异常,可以记录或者泡出别的异常
// timeout 处理响应超时的情况

// 执行顺序1
request 
Middleware
Guard
Interceptor (Pipe, handler)
exception
response

// 执行顺序2
request 
Middleware
Guard
Pipe
handler
exception
response
```

安装nestjs
```JS
nest new meeting_room_booking_system_backend
```

## 安装数据库相关插件
typeorm mysql2 插件
```JS
yarn add @nestjs/typeorm typeorm mysql2

// 配置 
import { TypeOrmModule } from '@nestjs/typeorm';

TypeOrmModule.forRootAsync({
    useFactory(configService: ConfigService) {
        return {
            type: 'mysql',
            host: configService.get('mysql_server_host'),
            port: configService.get('mysql_server_port'),
            username: configService.get('mysql_server_username'),
            password: configService.get('mysql_server_password'),
            database: configService.get('mysql_server_database'),
            synchronize: true,
            logging: true,
            entities: [User, Role, Permission],
            poolSize: 10,
            connectorPackage: 'mysql2',
            // extra: { // 额外的身份验证插件
            // 	authPlugin: 'sha256_password',
            // },
        };
    },
    inject: [ConfigService],
}),
```

参数校验
```JS
yarn add class-validator class-transformer

import { IsEmail, IsNotEmpty, MinLength } from 'class-validator';

export class RegisterUserDto {

    @IsNotEmpty({
        message: '用户名不能为空',
    })
}
```

安装 @nestjs/jwt
```JS
yarn add @nestjs/jwt

// 全局配置  设置了 JWT 的基本配置
// module
JwtModule.registerAsync({
    global: true,
    useFactory(configService: ConfigService) {
        return {
            secret: configService.get('jwt_secret'),
            signOptions: {
                expiresIn: '30m',
            },
        };
    },
    inject: [ConfigService],
}),

//  用于验证 JSON Web Token（JWT）的方法
this.jwtService.verify(token)

// 用于生成签名
this.jwtService.sign()
```

安装 redis
```JS
yarn add redis

// 设置链接
@Global()
@Module({
	providers: [
		RedisService,
		//添加连接 redis 的 provider
		{
			provide: 'REDIS_CLIENT',
			async useFactory(configService: ConfigService) {
				const client= createClient({
					socket: {
						host: configService.get('redis_server_host'),
						port: configService.get('redis_server_port'),
					},
					database: configService.get('redis_server_database'),
				});
				await client.connect();
				return client; // 返回Redis客户端实例
			},
			inject: [ConfigService],
		}
	],
	exports: [RedisService]
})
export class RedisModule {}

// 设置
this.redisClient.expire(key, ttl)
// 获取
this.redisClient.get(key);
```

安装发送邮件的包 nodemailer
```JS
yarn add nodemailer
```

安装关于 .env 的配置文件
```JS
yarn add @nestjs/config

// 设置 
@Module({
    imports: [
        ConfigModule.forRoot({
            isGlobal: true, // 全局配置
            envFilePath: 'src/.env', // 读取的配置文件
        }),
    ]
})
export class AppModule {}

// 之后可以通过 
import { ConfigService } from '@nestjs/config';
// 这样可以获得里面参数
configService.get(参数)
```



接口访问记录的 interceptor
```JS
nest g interceptor invoke-record --flat
```

安装日志系统
```JS
yarn add @nestjs/logger
```
